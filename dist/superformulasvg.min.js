function draw(){null!=paper.project&&paper.project.clear(),drawBackground(),mode==RANGE&&drawGridLines(),drawAllPaths(),alreadyScaled=alreadyScaled||!0,parameters[mode].drawParams&&drawAllParamText()}function refresh(){alreadyScaled=!1,params=getNewParams(),superformulaPaths=getSuperformulaPaths()}function drawBackground(){var a=new paper.Path.Rectangle({point:[0,0],size:[innerWidth,window.innerHeight]});a.sendToBack(),void 0!==parameters[mode]&&void 0!==parameters[mode].invert&&(parameters[mode].invert?a.fillColor=invertedBackgroundColor:a.fillColor=backgroundColor)}function drawGridLines(){for(var a=1;a<parameters[mode].rows;a++){var e=paper.Path.Line(new paper.Point(0,a*(window.innerHeight/parameters[mode].rows)),new paper.Point(window.innerWidth,a*(window.innerHeight/parameters[mode].rows)));parameters[mode].invert?e.strokeColor=invertedGridColor:e.strokeColor=gridColor}for(a=1;a<parameters[mode].columns;a++){var r=paper.Path.Line(new paper.Point(a*(window.innerWidth/parameters[mode].columns),0),new paper.Point(a*(window.innerWidth/parameters[mode].columns),window.innerHeight));parameters[mode].invert?r.strokeColor=invertedGridColor:r.strokeColor=gridColor}}function drawAllPaths(){var a,e,r;if(mode==TUNING?(a=window.innerWidth,e=window.innerHeight):mode==RANGE&&(a=window.innerWidth/parameters[RANGE].columns,e=window.innerHeight/parameters[RANGE].rows),r=a<e?a:e,mode==TUNING)drawPaths(superformulaPaths,window.innerWidth/2,window.innerHeight/2,r);else if(mode==RANGE)for(var i=0,n=0;n<parameters[RANGE].columns;n++)for(var m=0;m<parameters[RANGE].rows;m++)drawPaths(superformulaPaths[i],n*(window.innerWidth/parameters[RANGE].columns)+a/2,m*(window.innerHeight/parameters[RANGE].rows)+e/2,r),i++}function drawPaths(a,e,r,i){for(var n=largestRadius=0;n<a.length;n++)for(var m=0;m<a[n].segments.length;m++){var t=a[n].segments[m].point,t=Math.sqrt(t.x*t.x+t.y*t.y);t>largestRadius&&(largestRadius=t)}group=new paper.Group(a),group.position.x=e,group.position.y=r,parameters[mode].invert?group.strokeColor=invertedLineColor:group.strokeColor=lineColor,alreadyScaled||(scaleFactor=.9*i/(2*largestRadius),group.scale(scaleFactor))}function drawAllParamText(){if(mode==TUNING)drawParamText(params,20,70);else if(mode==RANGE)for(var a=0,e=0;e<parameters[RANGE].columns;e++)for(var r=0;r<parameters[RANGE].rows;r++)drawParamText(params[a],e*(window.innerWidth/parameters[RANGE].columns)+10,r*(window.innerHeight/parameters[RANGE].rows)+20),a++}function drawParamText(a,e,r){var i,n=[];for(i in n.a=new paper.PointText(e,r),n.a.content="a: "+a.a.toFixed(2),n.b=new paper.PointText(new paper.Point(e,r+15)),n.b.content="b: "+a.b.toFixed(2),n.m=new paper.PointText(new paper.Point(e,r+30)),parameters[mode].closePaths?n.m.content="m: "+a.m:n.m.content="m: "+a.m.toFixed(2),n.n1=new paper.PointText(new paper.Point(e,r+45)),n.n1.content="n1: "+a.n1.toFixed(2),n.n2=new paper.PointText(new paper.Point(e,r+60)),n.n2.content="n2: "+a.n2.toFixed(2),n.n3=new paper.PointText(new paper.Point(e,r+75)),n.n3.content="n3: "+a.n3.toFixed(2),n.iterations=new paper.PointText(new paper.Point(e,r+90)),n.iterations.content="iterations: "+a.iterations,n.decay=new paper.PointText(new paper.Point(e,r+105)),n.decay.content="decay: "+a.decay.toFixed(2),n)parameters[mode].invert?n[i].fillColor=invertedTextColor:n[i].fillColor=textColor;return new paper.Group(n)}var mode;window.onload=function(){var a=document.getElementById("superformula-canvas");paper.setup(a),backgroundColor=new paper.Color(0,0,0,.05),invertedBackgroundColor=new paper.Color(0,0,0,.9),lineColor=new paper.Color(0,0,0,.6),invertedLineColor=new paper.Color(1,1,1,.6),gridColor=new paper.Color(0,0,0,.1),invertedGridColor=new paper.Color(1,1,1,.1),textColor=new paper.Color(0,0,0,.8),invertedTextColor=new paper.Color(1,1,1,.6),setupModal(),showChoices()};var gui,aSlider,bSlider,mSlider,n1Slider,n2Slider,n3Slider,iterationsSlider,decaySlider,aMinSlider,bMinSlider,mMinSlider,n1MinSlider,n2MinSlider,n3MinSlider,iterationsMinSlider,decayMinSlider,aMaxSlider,bMaxSlider,mMaxSlider,n1MaxSlider,n2MaxSlider,n3MaxSlider,iterationsMaxSlider,decayMaxSlider,invertButton,closePathsButton,drawParamstButton,backgroundColor,invertedBackgroundColor,gridColor,invertedGridColor,lineColor,invertedLineColor,textColor,invertedTextColor,choiceContainer,tuneBlock,rangeBlock,helpLink,backLink,iconLinks,modal,modalContent,superformulaPaths,params,triggeringElement,TUNING=0,RANGE=1,paramLimits={a:{min:1,max:20},b:{min:1,max:20},m:{min:1,max:20},n1:{min:2,max:80},n2:{min:4,max:80},n3:{min:4,max:80},iterations:{min:1,max:20},decay:{min:.05,max:.2}},parameters=[{a:parseFloat(random(paramLimits.a.min,paramLimits.a.max)),b:parseFloat(random(paramLimits.b.min,paramLimits.b.max)),m:3,n1:parseFloat(random(paramLimits.n1.min,paramLimits.n1.max)),n2:parseFloat(random(paramLimits.n2.min,paramLimits.n2.max)),n3:parseFloat(random(paramLimits.n3.min,paramLimits.n3.max)),iterations:parseInt(random(paramLimits.iterations.min,paramLimits.iterations.max)),decay:parseFloat(random(paramLimits.decay.min,paramLimits.decay.max)),drawParams:!0,invert:!1,closePaths:!0},{a:{min:paramLimits.a.min,max:paramLimits.a.max},b:{min:paramLimits.b.min,max:paramLimits.b.max},m:{min:paramLimits.m.min,max:paramLimits.m.max},n1:{min:paramLimits.n1.min,max:paramLimits.n1.max},n2:{min:paramLimits.n2.min,max:paramLimits.n2.max},n3:{min:paramLimits.n3.min,max:paramLimits.n3.max},iterations:{min:paramLimits.iterations.min,max:paramLimits.iterations.max},decay:{min:paramLimits.decay.min,max:paramLimits.decay.max},drawParams:!0,invert:!1,closePaths:!0,rows:2,columns:3}],controlFunctions={randomize:function(){randomize()},generate:function(){generate()},svg:function(){exportSVG()},image:function(){exportImage()}},choicesSetup=!1,alreadyScaled=!1;function setupModal(){modal=document.querySelector(".modal"),modalContent=document.querySelector(".modal .modal-content");var e=document.querySelector(".help-icon-link");e.addEventListener("click",function(a){triggeringElement=e,showModal()});var r=document.querySelector(".help-link");r.addEventListener("click",function(a){triggeringElement=r,showModal()}),modal.addEventListener("keydown",function(a){"Escape"==a.key&&hideModal()})}function showModal(){modal.className=modal.className.replace(/\hide\b/g,"").trim(),modal.className=modal.className.replace(/\animated fadeOut\b/g,"").trim(),modal.className+=" animated fadeIn",modal.addEventListener("click",hideModal),modal.focus(),modalContent.className+=" animated fadeInDownBig",modalContent.className=modalContent.className.replace(/\animated fadeOutUpBig\b/g,"").trim()}function hideModal(){modal.className=modal.className.replace(/\animated fadeIn\b/g,"").trim(),modal.className+=" animated fadeOut",modal.removeEventListener("click",hideModal),triggeringElement.focus(),triggeringElement=null,setTimeout(function(){modal.className+=" hide"},1e3),modalContent.className=modalContent.className.replace(/\animated fadeInDownBig\b/g,"").trim(),modalContent.className+=" animated fadeOutUpBig"}function getNewParams(){if(mode==TUNING)(e={}).a=parameters[TUNING].a,e.b=parameters[TUNING].b,e.m=parameters[TUNING].m,parameters[TUNING].closePaths&&e.m%2!=0&&(e.m+1>=paramLimits.m.max?e.m--:e.m++),e.n1=parameters[TUNING].n1,e.n2=parameters[TUNING].n2,e.n3=parameters[TUNING].n3,e.iterations=parameters[TUNING].iterations,e.decay=parameters[TUNING].decay;else if(mode==RANGE)for(var a,e=[],r=0;r<parameters[RANGE].rows;r++)for(var i=0;i<parameters[RANGE].columns;i++)(a={}).a=Number(parseFloat(random(parameters[RANGE].a.min,parameters[RANGE].a.max)).toFixed(2)),a.b=Number(parseFloat(random(parameters[RANGE].b.min,parameters[RANGE].b.max)).toFixed(2)),parameters[RANGE].closePaths?(a.m=parseInt(random(parameters[RANGE].m.min,parameters[RANGE].m.max)),a.m%2!=0&&(a.m+1>=paramLimits.m.max?a.m--:a.m++)):a.m=Number(parseFloat(random(parameters[RANGE].m.min,parameters[RANGE].m.max)).toFixed(2)),a.n1=Number(parseFloat(random(parameters[RANGE].n1.min,parameters[RANGE].n1.max)).toFixed(2)),a.n2=Number(parseFloat(random(parameters[RANGE].n2.min,parameters[RANGE].n2.max)).toFixed(2)),a.n3=Number(parseFloat(random(parameters[RANGE].n3.min,parameters[RANGE].n3.max)).toFixed(2)),a.iterations=parseInt(random(parameters[RANGE].iterations.min,parameters[RANGE].iterations.max)),a.decay=Number(parseFloat(random(parameters[RANGE].decay.min,parameters[RANGE].decay.max)).toFixed(2)),e.push(a);return e}function getSuperformulaPaths(){var a=[];if(mode==TUNING)for(k=params.iterations;0<k;k--)a.push(getSuperformulaPath(params.a-k*params.decay,params.b-k*params.decay,params.m,params.n1-k*params.decay,params.n2-k*params.decay,params.n3-k*params.decay));else if(mode==RANGE)for(var e,r=0;r<parameters[RANGE].rows*parameters[RANGE].columns;r++){for(e=[],k=params[r].iterations;0<k;k--)e.push(getSuperformulaPath(params[r].a-k*params[r].decay,params[r].b-k*params[r].decay,params[r].m,params[r].n1-k*params[r].decay,params[r].n2-k*params[r].decay,params[r].n3-k*params[r].decay));a.push(e)}return a}function getSuperformulaPath(a,e,r,i,n,m){var t=2*Math.PI/720,o=new paper.Path;parameters[mode].invert?o.strokeColor=invertedLineColor:o.strokeColor=lineColor;for(var s=0;s<=720;s++)o.add(getSuperformulaPoint(t*s,a,e,r,i,n,m));return o}function getSuperformulaPoint(a,e,r,i,n,m,t){var o={},e=Math.cos(i*a/4)/e;return e=Math.abs(e),e=Math.pow(e,m),r=Math.sin(i*a/4)/r,r=Math.abs(r),r=Math.pow(r,t),n=Math.pow(e+r,1/n),0==Math.abs(n)?(o.x=0,o.y=0):(o.x=(n=1/n)*Math.cos(a),o.y=n*Math.sin(a)),o}function setupChoices(){choiceContainer=document.querySelector(".container"),choiceContent=document.querySelectorAll(".container .row"),tuneBlock=document.querySelector(".tune-block"),rangeBlock=document.querySelector(".range-block"),(backLink=document.querySelector(".back-link")).addEventListener("click",reloadApp),tuneBlock.addEventListener("click",function(){launchApp(TUNING)}),rangeBlock.addEventListener("click",function(){launchApp(RANGE)}),choicesSetup=!0}function showChoices(){choicesSetup||setupChoices(),choiceContainer.className=choiceContainer.className.replace(/\hide\b/g,"").trim();for(var a=0;a<choiceContent.length;a++)choiceContent[a].className+=" animated fadeIn"}function hideChoices(){choiceContainer.className+=" hide";for(var a=0;a<choiceContent.length;a++)choiceContent[a].className=choiceContent[a].className.replace(/\animated fadeIn\b/g,"").trim()}function launchApp(a){setMode(a),hideChoices(),showIconLinks(),setupGUI(),generate()}function reloadApp(){null!=paper&&null!=paper.project&&paper.project.clear(),hideIconLinks(),gui.destroy(),showChoices()}function showIconLinks(){void 0===iconLinks&&(iconLinks=document.querySelectorAll(".icon-link"));for(var a=0;a<iconLinks.length;a++)iconLinks[a].className=iconLinks[a].className.replace(/\hide\b/g,"").trim()}function hideIconLinks(){void 0===iconLinks&&(iconLinks=document.querySelectorAll(".icon-link"));for(var a=0;a<iconLinks.length;a++)iconLinks[a].className+=" hide"}function setMode(a){mode=a}function setupGUI(){var a,e,r,i,n,m,t,o;(gui=new dat.GUI).width=350,mode==TUNING?(aSlider=gui.add(parameters[TUNING],"a",paramLimits.a.min,paramLimits.a.max).onChange(generate),bSlider=gui.add(parameters[TUNING],"b",paramLimits.b.min,paramLimits.b.max).onChange(generate),mSlider=gui.add(parameters[TUNING],"m",paramLimits.m.min,paramLimits.m.max,2).onChange(generate),parameters[TUNING].closePaths&&mSlider.step(2),n1Slider=gui.add(parameters[TUNING],"n1",paramLimits.n1.min,paramLimits.n1.max).onChange(generate),n2Slider=gui.add(parameters[TUNING],"n2",paramLimits.n2.min,paramLimits.n2.max).onChange(generate),n3Slider=gui.add(parameters[TUNING],"n3",paramLimits.n3.min,paramLimits.n3.max).onChange(generate),iterationsSlider=gui.add(parameters[TUNING],"iterations",paramLimits.iterations.min,paramLimits.iterations.max,1).onChange(generate),decaySlider=gui.add(parameters[TUNING],"decay",paramLimits.decay.min,paramLimits.decay.max).onChange(generate),drawParamstButton=gui.add(parameters[TUNING],"drawParams",!0).name("Draw parameters").onChange(draw),invertButton=gui.add(parameters[TUNING],"invert",!1).name("Invert colors").onChange(invertColors),closePathsButton=gui.add(parameters[TUNING],"closePaths",!1).name("Only allow closed paths").onChange(closePaths),gui.add(controlFunctions,"randomize").name("Randomize"),gui.add(controlFunctions,"svg").name("Export SVG"),gui.add(controlFunctions,"image").name("Export image")):mode==RANGE&&(a=gui.addFolder("a"),e=gui.addFolder("b"),r=gui.addFolder("m"),i=gui.addFolder("n1"),n=gui.addFolder("n2"),m=gui.addFolder("n3"),t=gui.addFolder("iterations"),o=gui.addFolder("decay"),aMinSlider=a.add(parameters[RANGE].a,"min",paramLimits.a.min,paramLimits.a.max),aMaxSlider=a.add(parameters[RANGE].a,"max",paramLimits.a.min,paramLimits.a.max),bMinSlider=e.add(parameters[RANGE].b,"min",paramLimits.b.min,paramLimits.b.max),bMaxSlider=e.add(parameters[RANGE].b,"max",paramLimits.b.min,paramLimits.b.max),mMinSlider=r.add(parameters[RANGE].m,"min",paramLimits.m.min,paramLimits.m.max),mMaxSlider=r.add(parameters[RANGE].m,"max",paramLimits.m.min,paramLimits.m.max),parameters[RANGE].closePaths&&(mMinSlider.step(2),mMaxSlider.step(2)),n1MinSlider=i.add(parameters[RANGE].n1,"min",paramLimits.n1.min,paramLimits.n1.max),n1MaxSlider=i.add(parameters[RANGE].n1,"max",paramLimits.n1.min,paramLimits.n1.max),n2MinSlider=n.add(parameters[RANGE].n2,"min",paramLimits.n2.min,paramLimits.n2.max),n2MaxSlider=n.add(parameters[RANGE].n2,"max",paramLimits.n2.min,paramLimits.n2.max),n3MinSlider=m.add(parameters[RANGE].n3,"min",paramLimits.n3.min,paramLimits.n3.max),n3MaxSlider=m.add(parameters[RANGE].n3,"max",paramLimits.n3.min,paramLimits.n3.max),iterationsMinSlider=t.add(parameters[RANGE].iterations,"min",paramLimits.iterations.min,paramLimits.iterations.max).step(1),iterationsMaxSlider=t.add(parameters[RANGE].iterations,"max",paramLimits.iterations.min,paramLimits.iterations.max).step(1),decayMinSlider=o.add(parameters[RANGE].decay,"min",paramLimits.decay.min,paramLimits.decay.max),decayMaxSlider=o.add(parameters[RANGE].decay,"max",paramLimits.decay.min,paramLimits.decay.max),drawParamstButton=gui.add(parameters[RANGE],"drawParams",!0).name("Draw parameters").onChange(draw),invertButton=gui.add(parameters[RANGE],"invert",!1).name("Invert colors").onChange(invertColors),closePathsButton=gui.add(parameters[RANGE],"closePaths",!1).name("Only allow closed paths").onChange(closePaths),gui.add(parameters[RANGE],"rows",1,5).name("Rows").step(1),gui.add(parameters[RANGE],"columns",1,8).name("Columns").step(1),gui.add(controlFunctions,"randomize").name("Randomize"),gui.add(controlFunctions,"generate").name("Generate new forms"),gui.add(controlFunctions,"svg").name("Export SVG"),gui.add(controlFunctions,"image").name("Export image"))}function randomize(){mode==TUNING?(aSlider.setValue(parseFloat(random(paramLimits.a.min,paramLimits.a.max))),bSlider.setValue(parseFloat(random(paramLimits.b.min,paramLimits.b.max))),mSlider.setValue(parseFloat(random(paramLimits.m.min,paramLimits.m.max))),n1Slider.setValue(parseFloat(random(paramLimits.n1.min,paramLimits.n1.max))),n2Slider.setValue(parseFloat(random(paramLimits.n2.min,paramLimits.n2.max))),n3Slider.setValue(parseFloat(random(paramLimits.n3.min,paramLimits.n3.max))),iterationsSlider.setValue(parseInt(random(paramLimits.iterations.min,paramLimits.iterations.max))),decaySlider.setValue(parseFloat(random(paramLimits.decay.min,paramLimits.decay.max)))):mode==RANGE&&(aMinSlider.setValue(parseFloat(random(paramLimits.a.min,paramLimits.a.max))),aMaxSlider.setValue(parseFloat(random(aMinSlider.getValue(),paramLimits.a.max))),bMinSlider.setValue(parseFloat(random(paramLimits.b.min,paramLimits.b.max))),bMaxSlider.setValue(parseFloat(random(bMinSlider.getValue(),paramLimits.b.max))),mMinSlider.setValue(parseFloat(random(paramLimits.m.min,paramLimits.m.max))),mMaxSlider.setValue(parseFloat(random(mMinSlider.getValue(),paramLimits.m.max))),n1MinSlider.setValue(parseFloat(random(paramLimits.n1.min,paramLimits.n1.max))),n1MaxSlider.setValue(parseFloat(random(n1MinSlider.getValue(),paramLimits.n1.max))),n2MinSlider.setValue(parseFloat(random(paramLimits.n2.min,paramLimits.n2.max))),n2MaxSlider.setValue(parseFloat(random(n2MinSlider.getValue(),paramLimits.n2.max))),n3MinSlider.setValue(parseFloat(random(paramLimits.n3.min,paramLimits.n3.max))),n3MaxSlider.setValue(parseFloat(random(n3MinSlider.getValue(),paramLimits.n3.max))),iterationsMinSlider.setValue(parseInt(random(paramLimits.iterations.min,paramLimits.iterations.max))),iterationsMaxSlider.setValue(parseInt(random(iterationsMinSlider.getValue(),paramLimits.iterations.max))),decayMinSlider.setValue(parseFloat(random(paramLimits.decay.min,paramLimits.decay.max))),decayMaxSlider.setValue(parseFloat(random(decayMinSlider.getValue(),paramLimits.decay.max))))}function generate(){refresh(),draw()}function exportSVG(){var a=paper.project.exportSVG({asString:!0}),a=new Blob([a],{type:"image/svg+xml;charset=utf-8"});saveAs(a,"superformula.svg")}function exportImage(){paper.view.element.toBlob(function(a){saveAs(a,"superformula.png")})}function invertColors(){if(parameters[mode].invert){backLink.className+=" inverted";for(var a=0;a<iconLinks.length;a++)iconLinks[a].className+=" inverted"}else{backLink.className=backLink.className.replace(/\inverted\b/g,"").trim();for(a=0;a<iconLinks.length;a++)iconLinks[a].className=iconLinks[a].className.replace(/\inverted\b/g,"").trim()}draw()}function closePaths(){var a,e,r=parameters[mode].closePaths?a=2:(paramLimits.m.max-(a=.01))/100;paramLimits.m.min=a,mode==TUNING?(mSlider.min(paramLimits.m.min),mSlider.step(r),e=mSlider.getValue(),mSlider.setValue(2*Math.round(e/2))):mode==RANGE&&(mMinSlider.min(paramLimits.m.min),mMaxSlider.min(paramLimits.m.min),mMinSlider.step(r),mMaxSlider.step(r),parameters[mode].closePaths&&(e=mMinSlider.getValue(),r=mMaxSlider.getValue(),mMinSlider.setValue(2*Math.round(e/2)),mMaxSlider.setValue(2*Math.round(r/2))))}function random(a,e){return Math.random()*(e-a)+a}document.addEventListener("keyup",function(a){switch(a.key){case" ":mode==RANGE&&generate();break;case"s":exportSVG();break;case"i":parameters[mode].invert=!parameters[mode].invert,invertColors();break;case"p":exportImage();break;case"r":randomize(),generate()}});